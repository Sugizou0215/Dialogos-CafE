<div class="container">
  <div class ="row">
    <h2 class="col-10">
      イベント詳細
      <small>
        <% if @event.deadline < Time.now %>
          <i class="fas fa-exclamation-circle"></i>このイベントはすでに参加が締め切られています。
        <% elsif @event.is_valid == false %>
          <i class="fas fa-exclamation-circle"></i>このイベントの開催は中止されています。
        <% elsif @event.users.count == @event.capacity %>
          <i class="fas fa-exclamation-circle"></i>このイベントはすでに定員に達しています。
        <% elsif @event.users.include?(current_user) %>
          <i class="fas fa-exclamation-circle"></i>このイベントに参加予定です。
        <% end %>
      </small>
    </h2>
    <h4 class="text-right col-2">
      <% if @event.bookmark_by?(current_user) %>
        <%= link_to event_bookmarks_path(@event), method: :delete do %>
          <i class="fas fa-bookmark"></i></i><%= @event.bookmarks.count %>
        <% end %>
      <% else %>
        <%= link_to event_bookmarks_path(@event), method: :post do %>
          <i class="far fa-bookmark"></i></i><%= @event.bookmarks.count %>
        <% end %>
      <% end %>
    </h4>
    <table class="col-10 table table-striped table-condensed">
      <tr>
        <td>
          <%= attachment_image_tag(@event, :event_image, :fill, 50, 50, fallback: "no-image-icon.jpg", size: "100x100", class:"rounded-circle" ) %>
        </td>
        <td></td>
      </tr>
      <tr>
        <td>イベント名</td>
        <td><%= @event.name %></td>
      </tr>
      <tr>
        <td>開催日時</td>
        <td><%= event_time(@event) %></td>
      </tr>
      <tr>
        <td>参加締め切り日時</td>
        <td><%= @event.deadline.strftime('%Y/%m/%d %H:%M') %></td>
      </tr>
      <tr>
        <td>参加定員</td>
        <td><%= @event.capacity %>人(現在<%= @event.users.count %>人が参加中)</td>
      </tr>
      <tr>
        <td>使用ツール</td>
        <td><%= @event.tool %></td>
      </tr>
      <tr>
        <td>イベント主催者</td>
        <td><%= link_to @admin_user.name, user_path(@admin_user) %></td>
      </tr>
      <% if @admin_user == current_user %>
        <tr>
          <td>イベント参加者</td>
          <td>
            <% @event.users.each do |member| %>
              <li><%= link_to member.name, user_path(member) %><br></li>
            <% end %>
          </td>
        </tr>
       <% end %>
    </table>
    <% if @admin_user == current_user %>
      <%= link_to '編集する', edit_event_path, class: 'btn btn-info' %></br>
      <% if @event.is_valid == true %>
        <%= link_to '中止する', cancel_event_path, class: 'btn btn-danger', method: :patch %>
      <% else %>
        <%= link_to '再開する', cancel_event_path, class: 'btn btn-success', method: :patch %>
      <% end %>
    <% else %>
      <% if @event.users.include?(current_user) %>
        <%= link_to '参加を取り消す', event_leave_path(@event), method: :delete, class: 'btn btn-danger' %>
      <% else %>
        <% unless @event.deadline < Time.now || @event.is_valid == false || @event.users.count == @event.capacity %>
          <%= link_to '参加する', event_join_path(@event), class: 'btn btn-success'%>
        <% end %>
      <% end %>
    <% end %>
  </div>
  <div class="row">
    <h2>コメント</h2>
    <table class ="table">
      <tbody class="bg-light">
        <% @event.event_comments.each do |event_comment| %>
          <tr>
            <td>
              <%= attachment_image_tag(event_comment.user, :user_image, :fill, 50, 50, fallback: "no-image-icon.jpg", size: "100x100", class:"rounded-circle ml-2 mt-2" ) %>
            </td>
            <td><%= event_comment.user.name %></td>
            <td><%= event_comment.created_at.strftime('%Y/%m/%d') %></td>
            <td><%= event_comment.comment %></td>
            <% if event_comment.user == current_user %>
              <td>
                <%= link_to "削除", event_event_comment_path(event_comment.event, event_comment), method: :delete %>
              </td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
    <div class="form-group col-12">
      <%= form_with(model:[@event, @event_comment], local: true) do |f| %>
        <%= f.text_area :comment, rows:'3',placeholder: "コメントをここに",class:"form-control" %>
        <%= f.submit "送信する",class:"btn btn-success mt-2 float-right" %>
      <% end %>
    </div>
  </div>
</div>